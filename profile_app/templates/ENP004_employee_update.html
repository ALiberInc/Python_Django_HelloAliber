{% extends 'base.html'%}
{% load static %}
{% block title %}社員編集{% endblock %}
{% block active_profile_show %}active{% endblock %}
{% block head %}
<link href="{% static 'css/HS.css' %}" rel="stylesheet">
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
{% endblock %}
{% block contents %}
    <div class="container">
        <div class="row">
            <div class="my-div-style w-100">
                <form method="post" enctype="multipart/form-data" class="form">
                    {% csrf_token %}
                    {% comment %} <table class="table">
                        {{ form.as_table }}
                    </table>  {% endcomment %}
                    {{ form.non_field_errors }}
                    
                    {% for field in form %}
                        {% comment %} {{field.auto_id}}  {% endcomment %}
                        {% if "emergency" not in field.auto_id %}
                            <div class="field">
                                <label class="my_class" for="{{ field.auto_id }}">{{ field.label }}</label>
                                {{ field }}
                                {% if field.help_text %}
                                    <span class="helptext">{{ field.help_text }}</span>
                                {% endif %}
                                {{ field.errors }}
                            
                                {% if field.auto_id == "id_postal_code" %}
                                <input id="search" type="button" value="検索" />
                                {% endif %}
                            </div>
                        {% endif %}
                    {% endfor %}
                    
                    <!-- 折り畳み展開 -->
                    <div id="accordion">
                        <p style="cursor:pointer;" id="emergency_1">▼ 緊急連絡先1：</p>
                        <ul>
                        <!-- 折り畳まれる部分 -->
                        <div id="open1" class="inner open1">
                            <div class="field">
                                {{ form.emergency_contact_1_name.label_tag }}
                                {{ form.emergency_contact_1_name }}
                                {{ form.emergency_contact_1_name.errors }}
                            </div>
                            <div class="field">
                                {{ form.emergency_contact_1_relationship.label_tag }}
                                {{ form.emergency_contact_1_relationship }}
                                {{ form.emergency_contact_1_relationship.errors }}
                            </div>
                            <div class="field">
                                {{ form.emergency_contact_1_phone.label_tag }}
                                {{ form.emergency_contact_1_phone }}
                                {{ form.emergency_contact_1_phone.errors }}
                            </div>         
                        </div>
                        </ul>

                        <!-- 折り畳み展開 -->
                        <p style="cursor:pointer;" id="emergency_2">▼ 緊急連絡先2：</p>
                        <ul>
                        <!-- 折り畳まれる部分 -->
                        <div id="open2" class="inner">
                            <div class="field">
                                {{ form.emergency_contact_2_name.label_tag }}
                                {{ form.emergency_contact_2_name }}
                                {{ form.emergency_contact_2_name.errors }}
                            </div>
                            <div class="field">
                                {{ form.emergency_contact_2_relationship.label_tag }}
                                {{ form.emergency_contact_2_relationship }}
                                {{ form.emergency_contact_2_relationship.errors }}
                            </div>
                            <div class="field">
                                {{ form.emergency_contact_2_phone.label_tag }}
                                {{ form.emergency_contact_2_phone }}
                                {{ form.emergency_contact_2_phone.errors }}
                            </div>         
                        </div>
                        </ul>
                    
                        <!-- 折り畳み展開 -->
                        <p style="cursor:pointer;" id="emergency_3">▼ 緊急連絡先3：</p>
                        <ul>
                        <!-- 折り畳まれる部分 -->
                        <div id="open3" class="inner">
                            <div class="field">
                                {{ form.emergency_contact_3_name.label_tag }}
                                {{ form.emergency_contact_3_name }}
                                {{ form.emergency_contact_3_name.errors }}
                            </div>
                            <div class="field">
                                {{ form.emergency_contact_3_relationship.label_tag }}
                                {{ form.emergency_contact_3_relationship }}
                                {{ form.emergency_contact_3_relationship.errors }}
                            </div>
                            <div class="field">
                                {{ form.emergency_contact_3_phone.label_tag }}
                                {{ form.emergency_contact_3_phone }}
                                {{ form.emergency_contact_3_phone.errors }}
                            </div>         
                        </div>
                        </ul>
                    </div>    
                    <br />
                    <script>
                    //画面初期表示
                    //判断緊急連絡先２開くか閉じる
                    //判断緊急連絡先２名前　blankかどうか
                    //tureの場合開く
                    //falseの場合閉じる
                    //判断緊急連絡先３同じ
                    $(function(){
                            
                        const emergency_1 = $('#emergency_1').next()
                        const emergency_2 = $('#emergency_2').next()
                        const emergency_3 = $('#emergency_3').next()
                        $('#open1').find('input').val()?emergency_1.slideDown():emergency_1.slideUp();
                        $('#open2').find('input').val()?emergency_2.slideDown():emergency_2.slideUp();
                        $('#open3').find('input').val()?emergency_3.slideDown():emergency_3.slideUp();
                        //console.log('open1'+$('#open1').find('input').val())
                        
                        $('#accordion p').click(function(){
                            $(this).next().slideToggle();
                        //$('#accordion p').not($(this)).next().slideUp();
                        });                     

                        // ［検索］ボタンクリックで郵便番号検索を実行
                        $('#search').click(function() {
                            $.getJSON('http://zipcloud.ibsnet.co.jp/api/search?callback=?',
                            {
                                zipcode: $('#id_postal_code').val()
                            }
                            )
                            // 結果を取得する
                            .done(function(data) {
                            // 中身が空でなければ、その値を［住所］欄に反映
                                if (data.results) {
                                    var result = data.results[0];
                                    $('#id_address1').val(result.address1 + result.address2 + result.address3);
                                }
                                // 中身が空の場合は、エラーメッセージを反映
                                else {
                                    $('#id_address1').val();
                                    alert('該当する住所が存在しません。')
                                }
                            });
                        });
                    });
                    </script>

                    <button class="btn btn-primary" type="submit">保存</button>
                    <INPUT type="button"  class="btn btn-secondary ml-2" value="戻る" onClick="history.back()">
                </form>
            </div>
        </div>
    </div>
{% endblock %}